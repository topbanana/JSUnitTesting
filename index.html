<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Unit Testing Javascript</title>
		<!-- metadata -->
		<style type="text/css">
			body {display: none}
		</style>
		<meta name="generator" content="S5" />
		<meta name="version" content="S5 1.1" />
		<meta name="presdate" content="20111128" />
		<meta name="author" content="J Breen" />
		<meta name="company" content="BBC Worldwide" />
		<!-- configuration parameters -->
		<meta name="defaultView" content="slideshow" />
		<meta name="controlVis" content="hidden" />
		<!-- style sheet links -->
		<link rel="stylesheet" href="ui/default/slides.css" type="text/css" media="projection" id="slideProj" />
		<link rel="stylesheet" href="ui/default/outline.css" type="text/css" media="screen" id="outlineStyle" />
		<link rel="stylesheet" href="ui/default/print.css" type="text/css" media="print" id="slidePrint" />
		<link rel="stylesheet" href="ui/default/opera.css" type="text/css" media="projection" id="operaFix" />
		<!-- S5 JS -->
		<script src="ui/default/slides.js" type="text/javascript"></script>
	</head>
	<body>
		<div class="layout">
			<div id="controls"><!-- DO NOT EDIT --></div>
			<div id="currentSlide"><!-- DO NOT EDIT --></div>
			<div id="header"></div>
			<div id="footer">
				<!--h1>28th October 2011</h1-->
				<h3>Unit Testing Javascript</h3>
			</div>
		</div>
		
		<div class="presentation">
		
			<div class="slide">
				<h1>Unit Testing Javascript</h1>
				<div class="slidecontent">
					<h3>Without going to extremes</h3>
					<h3>JB</h3>
					<h4>TG Dev</h4>
				</div>
			</div>
			
			<div class="slide">
				<h1>Javascript</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>An interpreted language with many influences</li>
						<li>Delivered as is without development tools</li>
						<li>Runtimes historically execute in context of Browser</li>
						<li>Does not provide module or component patterns</li>
						<li>Tightly coupled with the DOM</li>
					</ul>
				</div>
				<!--div class="handout"></div-->
			</div>

			
			<div class="slide">
				<h1>Test driven development</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Software developed in short cycles</li>
						<li>Supported by unit tests defining correct behaviour</li>
						<li>Test code first, application code second</li>
						<li>Failing test based on requirement</li>
						<li>Write application code</li>
						<li>Observe passing tests and repeat</li>
					</ul>
				</div>
				<!--div class="handout"></div-->
			</div>
			
			<div class="slide">
				<h1>Test driven Javascript develoment</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Build components</li>
						<li>Decouple from DOM and DOM coupled libraries</li>
						<li>Decouple from the UI and it's interactions</li>
						<li>Tests must be separate from application</li>
						<li>Tests should run as part of build</li>
					</ul>
				</div>
				<!--div class="handout"></div-->
			</div>

			<div class="slide">
				<h1>Writing Unit Tests</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Use a Unit Test Framework</li>
						<li><a href="http://yuilibrary.com/yui/docs/test/">YUI</a></li>
						<li><a href="http://www.jsunit.net/">JSUnit</a></li>
						<li><a href="https://github.com/pivotal/jasmine/">Jasmine</a></li>
						<li><a href="http://docs.jquery.com/Qunit">QUnit</a></li>
					</ul>
				</div>
			</div>

			<div class="slide">
				<h1>Using a Unit Test Framework</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Allow you to set up a scenario</li>
						<li>And reset or destroy it</li>
						<li>Make assertions about outcomes</li>
						<li>Fake objects you are decoupled from</li>
						<li>or objects your test has no interest in</li>
					</ul>
				</div>
				<div class="handout">
					<p>See <a href="http://www.slideshare.net/chrisjoha/testdriven-javascript-development-javazone-2010">Christian Johansen's presentation</a>.</p>
				</div>
			</div>

			<div class="slide">
				<h1>YUI Test</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Provided by Yahoo</li>
						<li>Well documented</li>
						<li>Provides most facilities required</li>
						<li>Web page orientated; requires a script tag in a html document</li>
						<li>Tests Yahoo Javascript components</li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>YUI Example 1: Failing test</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>
							<h3><a href="code/yui_unittests/library.js">Library.js</a></h3>
							<object class="lang-js prettyprint" data="code/yui_unittests/library.js" type="text/html" style="height: 40px; width: 100%;"></object>
						</li>
						<li>
							<h3><a href="code/yui_unittests/unittests.js">Unittests.js</a></h3>
							<object class="lang-js prettyprint" data="code/yui_unittests/unittests.js" type="text/html" style="height: 300px; width: 100%;"></object>
						</li>
					</ul>
				</div>
			</div>

			<div class="slide">
				<h1>YUI Example 1: Test output</h1>
				<div class="slidecontent">
					<h3>Test output</h3>
					<object data="code/yui_unittests/fixture1.html" type="text/html" style="height: 400px; width: 100%;"></object>
				</div>
			</div>
			
			<div class="slide">
				<h1>YUI Example 2: Passing test</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>
							<h3><a href="code/yui_unittests_2/library.js">Library.js</a></h3>
							<object data="code/yui_unittests_2/library.js" type="text/html" style="height: 90px; width: 100%;"></object>
						</li>
						<li>
							<h3><a href="code/yui_unittests_2/unittests.js">Unittests.js</a></h3>
							<object data="code/yui_unittests_2/unittests.js" type="text/html" style="height: 300px; width: 100%;"></object>
						</li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>YUI Example 2: Test output</h1>
				<div class="slidecontent">
					<h3>Test output</h3>
					<object data="code/yui_unittests_2/fixture1.html" type="text/html" style="height: 400px; width: 100%;"></object>
				</div>
			</div>
			
			<div class="slide">
				<h1>YUI Example 3: Failing test</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>
							<h3><a href="code/yui_unittests_3/library.js">Library.js</a></h3>
							<object data="code/yui_unittests_3/library.js" type="text/html" style="height: 90px; width: 100%;"></object>
						</li>
						<li>
							<h3><a href="code/yui_unittests_3/unittests.js">Unittests.js</a></h3>
							<object data="code/yui_unittests_3/unittests.js" type="text/html" style="height: 800px; width: 100%;"></object>
						</li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>YUI Example 3: Test output</h1>
				<div class="slidecontent">
					<h3>Test output</h3>
					<object data="code/yui_unittests_3/fixture1.html" type="text/html" style="height: 400px; width: 100%;"></object>
				</div>
			</div>
			
			<div class="slide">
				<h1>YUI Example 4: Passing test</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>
							<h3><a href="code/yui_unittests_4/library.js">Library.js</a></h3>
							<object data="code/yui_unittests_4/library.js" type="text/html" style="height: 140px; width: 100%;"></object>
						</li>
						<li>
							<h3><a href="code/yui_unittests_4/unittests.js">Unittests.js</a></h3>
							<object data="code/yui_unittests_4/unittests.js" type="text/html" style="height: 300px; width: 100%;"></object>
						</li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>YUI Example 4: Test output</h1>
				<div class="slidecontent">
					<h3>Test output</h3>
					<object data="code/yui_unittests_4/fixture1.html" type="text/html" style="height: 400px; width: 100%;"></object>
				</div>
			</div>

			<div class="slide">
				<h1>QUnit</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Provided by JQuery</li>
						<li>Well documented</li>
						<li>Provides simple facilities</li>
						<li>Very simple usage</li>
						<li>Tests JQuery library</li>
					</ul>
				</div>
				<div class="handout">
					<ul>
						<li><a href="http://net.tutsplus.com/tutorials/javascript-ajax/how-to-test-your-javascript-code-with-qunit/">How to Test your JavaScript Code with QUnit </a></li>
						<li><a href="http://twoguysarguing.wordpress.com/2010/11/06/qunit-and-the-command-line-one-step-closer/">QUnit and the Command Line: One Step Closer,</a></li>
						<li><a href="http://www.swift-lizard.com/2009/11/24/test-driven-development-with-jquery-qunit/">Development with jQuery & Qunit</a></li>
						<li><a href="https://github.com/benjaminplee/QUnit-CLI">Extensions for running QUnit tests from the command line</a></li>
					</ul>
				</div>
			</div>			
			
			<div class="slide">
				<h1>QUnit Example 1: Failing test</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>
							<h3><a href="code/qunit_unittests/library.js">Library.js</a></h3>
							<object class="lang-js prettyprint" data="code/qunit_unittests/library.js" type="text/html" style="height: 40px; width: 100%;"></object>
						</li>
						<li>
							<h3><a href="code/qunit_unittests/unittests.js">Unittests.js</a></h3>
							<object class="lang-js prettyprint" data="code/qunit_unittests/unittests.js" type="text/html" style="height: 300px; width: 100%;"></object>
						</li>
					</ul>
				</div>
			</div>

			<div class="slide">
				<h1>QUnit Example 1: Test output</h1>
				<div class="slidecontent">
					<h3>Test output</h3>
					<object data="code/qunit_unittests/fixture1.html" type="text/html" style="height: 400px; width: 100%;"></object>
				</div>
			</div>
			
			<div class="slide">
				<h1>QUnit Example 2: Passing test</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>
							<h3><a href="code/qunit_unittests_2/library.js">Library.js</a></h3>
							<object data="code/qunit_unittests_2/library.js" type="text/html" style="height: 90px; width: 100%;"></object>
						</li>
						<li>
							<h3><a href="code/qunit_unittests_2/unittests.js">Unittests.js</a></h3>
							<object data="code/qunit_unittests_2/unittests.js" type="text/html" style="height: 300px; width: 100%;"></object>
						</li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>QUnit Example 2: Test output</h1>
				<div class="slidecontent">
					<h3>Test output</h3>
					<object data="code/qunit_unittests_2/fixture1.html" type="text/html" style="height: 300px; width: 100%;"></object>
				</div>
			</div>
			
			<div class="slide">
				<h1>QUnit Example 3: Failing test</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>
							<h3><a href="code/qunit_unittests_3/library.js">Library.js</a></h3>
							<object data="code/qunit_unittests_3/library.js" type="text/html" style="height: 90px; width: 100%;"></object>
						</li>
						<li>
							<h3><a href="code/qunit_unittests_3/unittests.js">Unittests.js</a></h3>
							<object data="code/qunit_unittests_3/unittests.js" type="text/html" style="height: 300px; width: 100%;"></object>
						</li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>QUnit Example 3: Test output</h1>
				<div class="slidecontent">
					<h3>Test output</h3>
					<object data="code/qunit_unittests_3/fixture1.html" type="text/html" style="height: 400px; width: 100%;"></object>
				</div>
			</div>
			
			<div class="slide">
				<h1>QUnit Example 4: Passing test</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>
							<h3><a href="code/qunit_unittests_4/library.js">Library.js</a></h3>
							<object data="code/qunit_unittests_4/library.js" type="text/html" style="height: 140px; width: 100%;"></object>
						</li>
						<li>
							<h3><a href="code/qunit_unittests_4/unittests.js">Unittests.js</a></h3>
							<object data="code/qunit_unittests_4/unittests.js" type="text/html" style="height: 300px; width: 100%;"></object>
						</li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>QUnit Example 4: Test output</h1>
				<div class="slidecontent">
					<h3>Test output</h3>
					<object data="code/qunit_unittests_4/fixture1.html" type="text/html" style="height: 400px; width: 100%;"></object>
				</div>
			</div>


			<div class="slide">
				<h1>Unit Testing On The Server</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Running in the browser is slow</li>
						<li>Tests are meant to be fast</li>
						<li>Do we even care about Browsers?</li>
						<li>How can you run Javascript without a Browser?</li>
					</ul>
				</div>
			</div>
			<div class="slide">
				<h1>QUnit and Chutzpah (Webkit)</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Uses Webkit</li>
						<li>A Test Runner using <a href="http://www.phantomjs.org/">PhantomJs</a></li>
						<li>Run Javascript from the command line</li>
						<li><a href="http://visualstudiogallery.msdn.microsoft.com/71a4e9bd-f660-448f-bd92-f5a65d39b7f0">Or Visual Studio</a></li>
						<li>Or Teamcity</li>
						<li>Does not need a HTML Harness</li>
						<li>Point it at a directory and it'll find your tests and components</li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>QUnit and Chutzpah</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Pointing at the same location as the scripts
							<pre style="background-color: #000; display: block"><code style="font-family:consolas; color:#fff; font-size: 0.5em; line-height: 1em">C:\Projects\JSUnitTesting> bin\Chutzpah1.2.0\chutzpah.console.exe /path code\qunit_unittests</code></pre>
						</li>
						<li>Output:
							<pre style="background-color: #000; display: block "><code style="font-family:consolas; color:#fff;; font-size: 0.5em; line-height: 1em">Chutzpah console test runner (32-bit .NET 4.0.30319.237)
Copyright (C) 2011 Matthew Manela (http://matthewmanela.com).

chutzpah.dll:     Version 1.2.0.29

<span style="color:#f00">TestableObject:TestableObject Exists [FAIL]</span>
   Expected: "object", Actual: "undefined"
        in C:\Projects\JSUnitTesting\code\qunit_unittests\unittests.js(4,1) at TestableObject:TestableObject Exists

File: C:\Projects\JSUnitTesting\code\qunit_unittests\unittests.js
     1 total, 1 failed, took 0 seconds

<span style="#999">Tests complete: 1</span>
=== 1 total, 1 failed, took 0 seconds ===</code></pre>
						</li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>Chutzpah and Teamcity</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Chutzpah will work with Teamcity using the Command Line Build Runner</li>
						<li>%system.teamcity.build.workingDir%\tools\Chutzpah1.2.0\chutzpah.console.exe /path %system.teamcity.build.workingDir%\code\js.tests /teamcity</li>
					</ul>
				</div>
			</div>

						
			<div class="slide">
				<h1>Chutzpah and Teamcity: Example</h1>
				<div class="slidecontent">
					<object data="http://teamcity/viewLog.html?buildId=727069&tab=buildResultsDiv&buildTypeId=bt1915" type="text/html" style="height: 750px; width: 100%;"></object>
				</div>
			</div>

			<div class="slide">
				<h1>QUnit and Rhino (Mozilla)</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Uses <a href="http://www.mozilla.org/rhino/">Rhino</a></li>
						<li>A reference Javascript implementation written in Java</li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>QUnit and Rhino</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Pointing at a harness for Rhino to load the js
							<pre style="background-color: #000; display: block"><code style="font-family:consolas; color:#fff; font-size: 0.5em; line-height: 1em">C:\Projects\JSUnitTesting> java -cp bin\rhino1_7R3\js.jar org.mozilla.javascript.tools.shell.Main -opt -1 rhino-suites\qunit_unittests_4.js</code></pre>
						</li>
						<li>Output (on success, revision 4):
							<pre style="background-color: #000; display: block "><code style="font-family:consolas; color:#fff;; font-size: 0.5em; line-height: 1em">PASS undefined
PASS undefined</code></pre>
						</li>
						<li>Output (on failure, revision 3):
							<pre style="background-color: #000; display: block "><code style="font-family:consolas; color:#fff;; font-size: 0.5em; line-height: 1em">js: "lib/qunit/qunit.js", line 1172: Java class "[B" has no public instance field or method named "setInterval".
        at lib/qunit/qunit.js:1172
        at lib/qunit/qunit.js:1153
        at lib/qunit/qunit.js:1236
        at lib/qunit/qunit.js:1236
        at lib/qunit/qunit.js:1236
        at lib/qunit/qunit.js:105
        at lib/qunit/qunit.js:232
        at lib/qunit/qunit.js:859 (process)
        at lib/qunit/qunit.js:850 (synchronize)
        at lib/qunit/qunit.js:231 (run)
        at lib/qunit/qunit.js:859 (process)
        at lib/qunit/qunit.js:850 (synchronize)
        at lib/qunit/qunit.js:246
        at lib/qunit/qunit.js:293
        at code/qunit_unittests_3/unittests.js:12
        at rhino-suites\qunit_unittests_3.js:12</code></pre>
						</li>
					</ul>
				</div>
			</div>

			<div class="slide">
				<h1>Mocking</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Components work against an interface</li>
						<li>Not an implementation</li>
						<li>i.e. Do I really need a real Document object in my component?</li>
						<li>Decouple your components from their implementations</li>
						<li>Mocking allows us to create fake objects</li>
						<li>Focus on the component's test</li>
						<li>Use to determine if object behaved correctly</li>
					</ul>
				</div>
			</div>
			<div class="slide">
				<h1>JSMocks Example</h1>
				<div class="slidecontent">
					<h3><a href="code/fullexample/library.js">Library.js</a></h3>
					<object data="code/fullexample/library.js" type="text/html" style="height: 550px; width: 100%;"></object>
				</div>
			</div>

			<div class="slide">
				<h1>JSMocks Example</h1>
				<div class="slidecontent">
					<h3><a href="code/fullexample/unittests.js">Unittests.js</a></h3>
					<object data="code/fullexample/unittests.js" type="text/html" style="height: 550px; width: 100%;"></object>
				</div>
			</div>
			
			<div class="slide">
				<h1>JSMocks Example Output</h1>
				<div class="slidecontent">
					<h3>Index.html</h3>
					<object data="code/fullexample" type="text/html" style="height: 700px; width: 100%;"></object>
				</div>
			</div>
			
			<div class="slide">
				<h1>Code Coverage</h1>
				<div class="slidecontent">
					<h3>Code Coverage</h3>
					<ul class="incremental">
						<li>How do you know if your tests are effective?</li>
						<li>What measurements can be made to support your tests?</li>
						<li>Are all code paths executed by your tests?</li>
						<li><a href="https://github.com/coveraje/coveraje">Coveraje</a></li>
						<li><a href="http://siliconforks.com/jscoverage/">JSCoverage</a></li>
						<li><a href="http://code.google.com/p/script-cover/">Script-Cover</a></li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>JSCoverage</h1>
				<div class="slidecontent">
					<h3>JSCoverage</h3>
					<ul class="incremental">
						<li>Command line or server</li>
						<li>Adds instrumentation to script</li>
						<li>Runs in a browser</li>
						<li>Can write report to disk</li>
						<li>Needs some work to hook into teamcity</li>
					</ul>
				</div>
			</div>
			
			<div class="slide">
				<h1>Using JSCoverage</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>
							<h3>Command line</h3>
							<pre style="background-color: #000; display: block"><code style="font-family:consolas; color:#fff; font-size: 0.5em; line-height: 1em">C:\Projects\JSUnitTesting> bin\jscoverage-0.5.1\jscoverage.exe code coverage</code></pre>
						</li>
						<li>
							<h3>Output</h3>
							<a href="coverage/jscoverage.html?u=/coverage/fullexample/" target="coverage">Click here (does not work embedded)</a>
						</li>
					</ul>
				</div>
			</div>

			<div class="slide">
				<h1>Using TDD</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>How do we actually use this and use TDD with Javascript</li>
						<li>Build Javascript components</li>
						<li>Remove dependancies so they really are components</li>
						<li>Use software engineering techniques to Keep Is Simple</li>
					</ul>
				</div>
			</div>	
			
			<div class="slide">
				<h1>Building components</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Use closures to take advantage of scope</li>
						<li>Plenty of interchangable class/module patterns</li>
						<li>Remove dependancies!</li>
						<li>Don't depend on anything! $, document, window, non-language global objects</li>
						<li>DOMParser yes! XMLSerializer yes! XSLTProcessor no!</li>
					</ul>
				</div>
			</div>	
			
			<div class="slide">
				<h1>Writing Tests</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>Think of a test as the 3 A's</li>
						<li>Arrange</li>
						<li><pre><code style="font-family:consolas; font-size: 0.5em; line-height: 1em">var inputData='The Owl and the Pussycat';</code></pre></li>
						<li>Act</li>
						<li><pre><code style="font-family:consolas; font-size: 0.5em; line-height: 1em">var output= obj.methodUnderTest(inputData);</code></pre></li>
						<li>Assert</li>
						<li><pre><code style="font-family:consolas; font-size: 0.5em; line-height: 1em">equals(output, 'Went to sea', 'Output not as expected.');</code></pre></li>
					</ul>
				</div>
			</div>	

			
			<div class="slide">
				<h1>Test Fixtures</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>A group of tests</li>
						<li>All tests for one component/JS in one file</li>
						<li>Naming tests becomes important</li>
						<li>Testdox format/Kent Beck seems a good standard, testSomeFeatureIsSomething </li>
						<li>Or even <a href="http://osherove.com/blog/2005/4/3/naming-standards-for-unit-tests.html">[MethodName_StateUnderTest_ExpectedBehavior]</a></li>
						<li><a href="http://dannorth.net/introducing-bdd/">There's a lot of ideas out there</a></li>
						<li>Be responsible</li>
					</ul>
				</div>
			</div>	

			<div class="slide">
				<h1>Rest Client To Update A Html Element When Someone Fires a UI Event</h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>...</li>
					</ul>
				</div>
			</div>	
			
			<!--
			<div class="slide">
				<h1></h1>
				<div class="slidecontent">
					<ul class="incremental">
						<li>
						</li>
					</ul>
				</div>
			</div>	
			-->
			
		</div>
	</body>
</html>
